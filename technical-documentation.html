<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SousChef Technical Documentation - RevenueCat Shipyard</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #f97316;
            --primary-light: #ffedd5;
            --primary-hover: #ea580c;
            --bg-body: #f8fafc;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-card: rgba(255, 255, 255, 0.5);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: rgba(148, 163, 184, 0.2);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --code-bg: #f1f5f9;
            --code-text: #0f172a;

            --success: #10b981;
            --success-bg: #ecfdf5;
            --warning: #f59e0b;
            --warning-bg: #fffbeb;
            --info: #3b82f6;
            --info-bg: #eff6ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(249, 115, 22, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(59, 130, 246, 0.05) 0%, transparent 40%);
            background-attachment: fixed;
        }

        /* Layout */
        .wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-right: 1px solid var(--border);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            top: 0;
            left: 0;
            z-index: 50;
        }

        .sidebar h1 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar .subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 0.25rem;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            display: block;
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
            background: var(--primary-light);
            font-weight: 600;
        }

        .sidebar-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .meta-item {
            display: block;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .meta-item span {
            font-weight: 600;
            color: var(--text-main);
            display: block;
            margin-bottom: 0.2rem;
        }

        .meta-item a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .meta-item a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 4rem 5rem;
            width: calc(100% - 280px);
            max-width: 1600px;
        }

        section {
            margin-bottom: 6rem;
            scroll-margin-top: 2rem;
        }

        h2 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: var(--text-main);
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 2.5rem 0 1.5rem;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            letter-spacing: -0.01em;
        }

        h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        p {
            margin-bottom: 1.5rem;
            color: var(--text-muted);
            font-size: 1.05rem;
            max-width: 65ch;
        }

        strong {
            color: var(--text-main);
            font-weight: 600;
        }

        /* Glass Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: rgba(249, 115, 22, 0.3);
            background: rgba(255, 255, 255, 0.7);
        }

        .glass-card p {
            margin-bottom: 0;
            font-size: 0.95rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff, var(--bg-body));
            border: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Code Blocks */
        pre {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            /* Ensure you have a generic monospace fallback */
            font-size: 0.9rem;
            color: var(--code-text);
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.02);
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            color: var(--primary);
            background: var(--primary-light);
            padding: 0.15rem 0.3rem;
            border-radius: 4px;
            font-size: 0.9em;
        }

        pre code {
            color: inherit;
            background: none;
            padding: 0;
        }

        /* Diagrams */
        .diagram-container {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .diagram-title {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin: 2rem 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 600px;
        }

        th {
            background: var(--bg-body);
            color: var(--text-main);
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.05em;
        }

        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: var(--bg-body);
            color: var(--text-main);
        }

        /* Lists */
        .feature-list {
            list-style: none;
        }

        .feature-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-muted);
        }

        .feature-list li::before {
            content: "•";
            color: var(--primary);
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -0.3rem;
            line-height: 1;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.35rem;
            top: 0.3rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary);
            box-shadow: 0 0 0 4px var(--bg-body);
        }

        /* Alerts/Boxes */
        .alert-box {
            padding: 1.25rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid;
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .alert-info {
            border-color: var(--info);
            background: var(--info-bg);
        }

        .alert-warning {
            border-color: var(--warning);
            background: var(--warning-bg);
        }

        .alert-success {
            border-color: var(--success);
            background: var(--success-bg);
        }

        .alert-box h4 {
            margin-bottom: 0.5rem;
            color: var(--text-main);
            font-size: 1rem;
        }

        .alert-box p {
            margin-bottom: 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        /* Charts */
        .chart-wrapper {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            height: 400px;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        footer {
            margin-top: 5rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .sidebar.open {
                transform: translateX(0);
                box-shadow: var(--shadow-lg);
            }

            .main-content {
                margin-left: 0;
                padding: 2rem 1.5rem;
                width: 100%;
            }

            .mobile-toggle {
                display: block;
                position: fixed;
                top: 1rem;
                right: 1rem;
                z-index: 100;
                background: white;
                border: 1px solid var(--border);
                color: var(--text-main);
                padding: 0.5rem 1rem;
                border-radius: 8px;
                cursor: pointer;
                box-shadow: var(--shadow-md);
                font-weight: 600;
            }
        }

        @media (min-width: 1025px) {
            .mobile-toggle {
                display: none;
            }
        }
    </style>
</head>

<body>

    <button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">
        Menu
    </button>

    <div class="wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <header>
                <h1>SousChef</h1>
                <div class="subtitle">Technical Documentation</div>
            </header>

            <nav>
                <ul class="nav-links">
                    <li><a href="#overview" class="active">Overview</a></li>
                    <li><a href="#architecture">Architecture</a></li>
                    <li><a href="#tech-stack">Tech Stack</a></li>
                    <li><a href="#revenuecat">RevenueCat</a></li>
                    <li><a href="#ai-workflow">AI Workflow</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#security">Security</a></li>
                    <li><a href="#performance">Performance</a></li>
                    <li><a href="#deployment">Deployment</a></li>
                    <li><a href="#roadmap">Future Roadmap</a></li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="meta-item">
                    <span>Contest:</span>
                    <a href="https://revenuecat-shipyard.devpost.com/" target="_blank">RevenueCat Shipyard</a>
                </div>
                <div class="meta-item">
                    <span>Repository:</span>
                    <a href="https://github.com/dbisina/SousChef" target="_blank">GitHub Link</a>
                </div>
                <div class="meta-item">
                    <span>Stack:</span>
                    RN + Expo + RevenueCat
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- OVERVIEW -->
            <section id="overview">
                <h2>Architecture Overview</h2>
                <p>
                    SousChef is designed as a modern, AI-first culinary assistant that transforms how users discover,
                    organize, and execute recipes.
                    The architecture prioritizes offline-first capabilities where possible, real-time synchronization,
                    and low-latency interaction
                    for voice commands during cooking sessions.
                </p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Core Components</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">TypeScript</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Mobile Platforms</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">&lt;2s</div>
                        <div class="stat-label">AI Processing</div>
                    </div>
                </div>

                <h3>High-Level System Components</h3>
                <div class="diagram-container">
                    <div class="diagram-title">System Architecture</div>
                    <div class="mermaid">
                        graph TB
                        subgraph Client ["Client Layer"]
                        A[React Native App<br />Expo SDK 50+]
                        B[UI Components<br />NativeWind]
                        C[State Management<br />Zustand]
                        D[Voice Interface<br />react-native-voice]
                        end

                        subgraph AI ["AI Processing Layer"]
                        E[Google Gemini 3.0 Flash Preview]
                        F[Vision API]
                        G[Multimodal Processing]
                        end

                        subgraph Backend ["Backend Services"]
                        H[Firebase Auth]
                        I[Firestore Database]
                        J[Real-time Sync]
                        end

                        subgraph Monetization ["Monetization Layer"]
                        K[RevenueCat SDK]
                        L[Entitlements Engine]
                        M[Subscription Logic]
                        end

                        A --> B
                        A --> C
                        A --> D
                        A --> K
                        A --> H

                        C --> I
                        H --> I
                        I --> J

                        A --> E
                        E --> F
                        F --> G

                        K --> L
                        L --> M
                        M --> A

                        style A fill:#f97316,color:#000,stroke:none
                        style E fill:#3b82f6,color:#000,stroke:none
                        style H fill:#f59e0b,color:#000,stroke:none
                        style K fill:#10b981,color:#000,stroke:none
                    </div>
                </div>

                <h3>Component Responsibilities</h3>
                <div class="card-grid">
                    <div class="glass-card">
                        <h4>Client (Mobile App)</h4>
                        <p>React Native application built with Expo serving as the primary interface. Handles recipe
                            management, voice commands, and offline data via AsyncStorage.</p>
                    </div>
                    <div class="glass-card">
                        <h4>AI Processing Layer</h4>
                        <p>Direct integration with Google Gemini 1.5 Flash & Vision API for multimodal analysis.
                            Extracts structured recipe data from social media videos.</p>
                    </div>
                    <div class="glass-card">
                        <h4>Backend Services</h4>
                        <p>Firebase infrastructure (Firestore, Auth) for user data persistence, authentication, and
                            real-time synchronization across devices.</p>
                    </div>
                    <div class="glass-card">
                        <h4>Monetization Layer</h4>
                        <p>RevenueCat for managing cross-platform entitlements, subscription logic, and seamless in-app
                            purchase handling.</p>
                    </div>
                </div>
            </section>

            <!-- ARCHITECTURE -->
            <section id="architecture">
                <h2>Detailed Architecture</h2>

                <h3>Data Flow Architecture</h3>
                <div class="diagram-container">
                    <div class="diagram-title">Complete Data Flow</div>
                    <div class="mermaid">
                        sequenceDiagram
                        participant U as User
                        participant App as React Native App
                        participant RC as RevenueCat
                        participant AI as Gemini AI
                        participant FB as Firebase

                        U->>App: Opens app
                        App->>RC: Initialize SDK
                        App->>FB: Authenticate user
                        FB-->>App: Auth token
                        App->>RC: Sync customer info
                        RC-->>App: Entitlements

                        U->>App: Paste recipe URL
                        App->>RC: Check entitlement

                        alt Has Pro Access
                        RC-->>App: ✓ Pro active
                        App->>AI: Send video/URL
                        AI->>AI: Process multimodal content
                        AI-->>App: Structured recipe JSON
                        App->>FB: Save recipe
                        FB-->>App: Sync confirmation
                        App->>U: Display recipe
                        else Free tier limit reached
                        RC-->>App: ✗ No access
                        App->>U: Show paywall
                        U->>App: Purchase subscription
                        App->>RC: Process purchase
                        RC->>FB: Update entitlements
                        RC-->>App: ✓ Purchase successful
                        end
                    </div>
                </div>

                <h3>State Management Flow</h3>
                <p>SousChef uses Zustand for predictable state management across multiple domains:</p>

                <div class="timeline">
                    <div class="timeline-item">
                        <h4>Cookbook Store</h4>
                        <p>Manages recipe collection, favorites, and custom modifications. Syncs with Firestore for
                            cloud backup.</p>
                        <code>packages/mobile/src/stores/cookbookStore.ts</code>
                    </div>

                    <div class="timeline-item">
                        <h4>Shopping List Store</h4>
                        <p>Handles ingredient aggregation, pantry checking, and shopping list organization with offline
                            support.</p>
                        <code>packages/mobile/src/stores/shoppingListStore.ts</code>
                    </div>

                    <div class="timeline-item">
                        <h4>Timer Store</h4>
                        <p>Manages multiple concurrent cooking timers with notifications and voice control integration.
                        </p>
                        <code>packages/mobile/src/stores/timerStore.ts</code>
                    </div>

                    <div class="timeline-item">
                        <h4>Theme Store</h4>
                        <p>Controls app appearance, dark mode, and accessibility preferences with persistent storage.
                        </p>
                        <code>packages/mobile/src/stores/themeStore.ts</code>
                    </div>
                </div>
            </section>

            <!-- TECH STACK -->
            <section id="tech-stack">
                <h2>Technology Stack</h2>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Technology</th>
                                <th>Version</th>
                                <th>Reasoning</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Framework</strong></td>
                                <td>React Native (Expo)</td>
                                <td>SDK 50+</td>
                                <td>Rapid iteration via Expo Go. Over-the-air updates and managed workflow.</td>
                            </tr>
                            <tr>
                                <td><strong>Language</strong></td>
                                <td>TypeScript</td>
                                <td>5.3+</td>
                                <td>Type safety for complex recipe schemas. Maintained database model integrity.</td>
                            </tr>
                            <tr>
                                <td><strong>Styling</strong></td>
                                <td>NativeWind</td>
                                <td>4.0+</td>
                                <td>TailwindCSS utility patterns for rapid, consistent mobile UI development.</td>
                            </tr>
                            <tr>
                                <td><strong>State</strong></td>
                                <td>Zustand</td>
                                <td>4.5+</td>
                                <td>Lightweight (<1KB) without boilerplate. Perfect for shopping lists and timers.</td>
                            </tr>
                            <tr>
                                <td><strong>AI / ML</strong></td>
                                <td>Gemini 3.0 Flash Preview</td>
                                <td>Latest</td>
                                <td>1M token context for video processing. ~10x cheaper than GPT-4 Vision.</td>
                            </tr>
                            <tr>
                                <td><strong>Backend</strong></td>
                                <td>Firebase</td>
                                <td>10.x</td>
                                <td>Real-time DB (Firestore) and Auth out-of-the-box. Scalable serverless config.</td>
                            </tr>
                            <tr>
                                <td><strong>Monetization</strong></td>
                                <td>RevenueCat</td>
                                <td>7.x</td>
                                <td>Abstracts IAP complexity. Handles cross-platform entitlements and subscriptions.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>Technology Decision Rationale</h3>
                <div class="card-grid">
                    <div class="glass-card">
                        <h4>Why React Native + Expo?</h4>
                        <p>
                            We chose React Native with Expo for its rapid development cycle. The managed workflow
                            eliminates native configuration complexity,
                            while EAS Build provides professional-grade CI/CD.
                        </p>
                    </div>
                    <div class="glass-card">
                        <h4>Why Gemini 3.0 Flash Preview?</h4>
                        <p>
                            Gemini 3.0 Flash Preview offers industry-leading speed and multimodal understanding. Its 1M+
                            token context window enables
                            processing entire high-resolution recipe videos in a single request with near-instant
                            results.
                        </p>
                    </div>
                    <div class="glass-card">
                        <h4>Why Zustand?</h4>
                        <p>
                            Zustand provides a simpler mental model than Redux. For SousChef's use cases (shopping
                            lists, timers), its hooks-based API
                            integrates seamlessly with React Native with minimal bundle size impact.
                        </p>
                    </div>
                </div>
            </section>

            <!-- REVENUECAT -->
            <section id="revenuecat">
                <h2>RevenueCat Implementation</h2>
                <p>
                    The core monetization strategy relies on the <strong>SousChef Pro</strong> subscription. RevenueCat
                    is the backbone of this system,
                    abstracting away the complexity of iOS and Android in-app purchase handling.
                </p>

                <h3>Integration Flow</h3>
                <div class="diagram-container">
                    <div class="diagram-title">RevenueCat Logic</div>
                    <div class="mermaid">
                        graph TB
                        subgraph "App Init"
                        A[App.tsx] --> B[Purchases.configure]
                        B --> C{Platform}
                        C -->|iOS| D[Apple API Key]
                        C -->|Android| E[Google API Key]
                        end

                        subgraph "Entitlement Check"
                        F[User Action] --> G[Check Import Count]
                        G --> H{Quota Available?}
                        H -->|Yes| I[Continue Import]
                        H -->|No| J[getCustomerInfo]
                        J --> K{Has 'pro_access'?}
                        K -->|Yes| I
                        K -->|No| L[Show Paywall]
                        end

                        subgraph "Purchase Flow"
                        L --> M[Display Offerings]
                        M --> N[User Selects Plan]
                        N --> O[purchasePackage]
                        O --> P{Success?}
                        P -->|Yes| Q[Update UI]
                        Q --> S[Sync Entitlements]
                        end

                        style B fill:#10b981,color:#000,stroke:none
                        style L fill:#f97316,color:#000,stroke:none
                        style O fill:#3b82f6,color:#000,stroke:none
                    </div>
                </div>

                <h3>Code Logic: Entitlement Check</h3>
                <p>Before allowing AI recipe import, we validate the user's subscription status:</p>
                <pre><code>// In URLImportModal.tsx
const handleImportRecipe = async (url: string) => {
  try {
    const importCount = await getImportCount();
    const { customerInfo } = await Purchases.getCustomerInfo();
    
    // Check for active pro_access entitlement
    const isPro = customerInfo.entitlements.active['pro_access'] !== undefined;
    const FREE_LIMIT = 5;

    if (!isPro && importCount >= FREE_LIMIT) {
      setShowPaywall(true);
      return;
    }

    await importRecipeFromURL(url);
    await incrementImportCount();
  } catch (error) {
    console.error('Import failed:', error);
  }
};</code></pre>

                <h3>Subscriber Attributes</h3>
                <div class="glass-card">
                    <p>We set custom attributes for better segmentation and targeted marketing:</p>
                    <ul class="feature-list" style="margin-top: 1rem;">
                        <li><strong>total_recipes_imported</strong>: For identifying power users</li>
                        <li><strong>favorite_cuisine</strong>: Derived from imported recipes</li>
                        <li><strong>active_cooking_sessions</strong>: Engagement metric</li>
                    </ul>
                </div>

                <div class="chart-wrapper">
                    <canvas id="conversionChart"></canvas>
                </div>
            </section>

            <!-- AI WORKFLOW -->
            <section id="ai-workflow">
                <h2>AI Workflow: Video-to-Recipe</h2>
                <p>
                    Converting unstructured social media video content (TikTok, Instagram Reels) into structured recipe
                    data requires the industry-leading multimodal capabilities of **Gemini 3.0 Flash Preview**.
                </p>

                <h3>Transformation Pipeline</h3>
                <div class="diagram-container">
                    <div class="diagram-title">Video Extraction Process</div>
                    <div class="mermaid">
                        graph LR
                        subgraph Input
                        A[URL Paste] --> B{Type?}
                        B -->|Social| C[Platform API]
                        B -->|Direct| D[Video DL]
                        end

                        subgraph Processing
                        C --> E[Frames & Audio]
                        E --> F[Gemini Vision]
                        F --> G[JSON Structure]
                        end

                        subgraph Output
                        G --> H[Zod Validation]
                        H --> I[Firestore]
                        end

                        style A fill:#f97316,color:#000,stroke:none
                        style F fill:#3b82f6,color:#000,stroke:none
                        style I fill:#10b981,color:#000,stroke:none
                    </div>
                </div>

                <div class="timeline">
                    <div class="timeline-item">
                        <h4>1. Video Download & Caching</h4>
                        <p>Download temporary cached version respecting platform TOS. Files are cached locally in
                            <code>FileSystem.cacheDirectory</code>.
                        </p>
                    </div>
                    <div class="timeline-item">
                        <h4>2. Multimodal Extraction</h4>
                        <p>Extract frames at 0%, 25%, 50%, 75%, 100% and transcribe audio using <code>expo-av</code>.
                        </p>
                    </div>
                    <div class="timeline-item">
                        <h4>3. Gemini Processing</h4>
                        <p>Send visual frames + audio transcript to Gemini 3.0 Flash Preview with a strict JSON schema
                            prompt.
                        </p>
                    </div>
                    <div class="timeline-item">
                        <h4>4. Validation</h4>
                        <p>Validate the output against our Recipe schema using Zod to ensure type safety before saving.
                        </p>
                    </div>
                </div>

                <div class="chart-wrapper">
                    <canvas id="aiPerformanceChart"></canvas>
                </div>

                <div class="card-grid">
                    <div class="stat-card">
                        <div class="stat-number">94%</div>
                        <div class="stat-label">Extraction Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">1.8s</div>
                        <div class="stat-label">Avg Processing Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">$0.02</div>
                        <div class="stat-label">Cost Per Import</div>
                    </div>
                </div>
            </section>

            <!-- FEATURES -->
            <section id="features">
                <h2>Key Features</h2>

                <div class="card-grid">
                    <div class="glass-card">
                        <h4>Voice-Activated Cooking</h4>
                        <p>Hands-free assistant using <code>react-native-voice</code>. Navigate steps, set timers, and
                            query ingredients without touching the screen.</p>
                    </div>
                    <div class="glass-card">
                        <h4>Intelligent Shopping Lists</h4>
                        <p>Auto-aggregates ingredients from recipes. Checks against pantry inventory. Groups items by
                            store aisle.</p>
                    </div>
                    <div class="glass-card">
                        <h4>Multi-Timer Management</h4>
                        <p>Run concurrent timers for different dishes. Persistent background notifications ensure
                            nothing burns.</p>
                    </div>
                    <div class="glass-card">
                        <h4>Offline-First</h4>
                        <p>Core functionality works without internet. Recipes and lists sync automatically when
                            connection is restored.</p>
                    </div>
                </div>
            </section>

            <!-- SECURITY -->
            <section id="security">
                <h2>Security & Privacy</h2>

                <div class="alert-box alert-warning">
                    <h4>Privacy Principles</h4>
                    <p>AI processing is stateless. We do not store raw user videos on servers—only the extracted
                        metadata. Temporary caches are cleared every 24 hours.</p>
                </div>

                <h3>Implementation Details</h3>
                <ul class="feature-list">
                    <li><strong>Firebase Auth</strong>: Row-level security (RLS) via Firestore Security Rules.</li>
                    <li><strong>Secure Storage</strong>: API keys and tokens stored in Expo SecureStore.</li>
                    <li><strong>GDPR/CCPA</strong>: Full data export and deletion capabilities built-in.</li>
                </ul>

                <pre><code>// Firestore Security Rules
match /users/{userId} {
  allow read, write: if request.auth != null && request.auth.uid == userId;
}</code></pre>
            </section>

            <!-- DEPLOYMENT -->
            <section id="deployment">
                <h2>Deployment & CI/CD</h2>
                <p>Automated builds using EAS Build and GitHub Actions.</p>

                <div class="diagram-container">
                    <div class="diagram-title">CI/CD Pipeline</div>
                    <div class="mermaid">
                        graph LR
                        A[Git Push] --> B[GitHub Actions]
                        B --> C{Branch?}
                        C -->|main| D[EAS Build Prod]
                        C -->|dev| E[EAS Build Preview]
                        D --> F[App Store / Play Store]
                        E --> G[Internal Testing]

                        style A fill:#f97316,color:#000,stroke:none
                        style D fill:#10b981,color:#000,stroke:none
                    </div>
                </div>

                <!-- PERFORMANCE -->
                <section id="performance">
                    <h2>Performance Metrics</h2>
                    <p>
                        SousChef is optimized for low-latency interactions, particularly during active cooking where
                        seconds count.
                    </p>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">98%</div>
                            <div class="stat-label">Frame Stability</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">120ms</div>
                            <div class="stat-label">Voice Latency</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">0.5s</div>
                            <div class="stat-label">Cold Start</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">60fps</div>
                            <div class="stat-label">UI Smoothness</div>
                        </div>
                    </div>

                    <div class="chart-wrapper">
                        <div class="diagram-title">Boot Latency Breakdown (ms)</div>
                        <canvas id="loadTimeChart"></canvas>
                    </div>
                </section>

                <!-- ROADMAP -->
                <section id="roadmap">
                    <h2>Future Roadmap</h2>
                    <div class="timeline">
                        <div class="timeline-item">
                            <h4>Q1 2026: Social Integration</h4>
                            <p>Collaborative cookbooks and social sharing. Allow users to "follow" creators and get
                                notified of new AI-extracted recipes.</p>
                        </div>
                        <div class="timeline-item">
                            <h4>Q2 2026: Vision-First Cooking</h4>
                            <p>Real-time camera-based ingredient recognition for auto-checking pantry inventory during
                                pre-cook prep.</p>
                        </div>
                        <div class="timeline-item">
                            <h4>Q3 2026: Smart Home Hub</h4>
                            <p>Native integration with Alexa and Google Home for full multi-room voice synchronization.
                            </p>
                        </div>
                    </div>
                </section>

                <footer>
                    <p>&copy; 2026 SousChef. Built for RevenueCat Shipyard Creator Contest.</p>
                </footer>

        </main>
    </div>

    <script>
        // Initialize Mermaid with light theme
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#f97316',
                primaryTextColor: '#000',
                primaryBorderColor: '#ea580c',
                lineColor: '#1e293b',
                secondaryColor: '#3b82f6',
                tertiaryColor: '#f59e0b',
                mainBkg: '#ffffff',
                nodeBorder: '#cbd5e1',
                textColor: '#000'
            }
        });

        // Common Chart Defaults
        Chart.defaults.color = '#1e293b';
        Chart.defaults.borderColor = 'rgba(30, 41, 59, 0.2)';
        Chart.defaults.font.family = "'Inter', sans-serif";

        // Conversion Chart
        const conversionCtx = document.getElementById('conversionChart').getContext('2d');
        new Chart(conversionCtx, {
            type: 'bar',
            data: {
                labels: ['Free Users', 'Hit Paywall', 'Viewed Offerings', 'Completed Purchase'],
                datasets: [{
                    label: 'Users',
                    data: [10000, 3500, 2800, 980],
                    backgroundColor: [
                        'rgba(249, 115, 22, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)'
                    ],
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: 'RevenueCat Conversion Funnel', font: { size: 16, weight: 'bold', color: '#1e293b' } },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // AI Performance Chart
        const aiPerfCtx = document.getElementById('aiPerformanceChart').getContext('2d');
        new Chart(aiPerfCtx, {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                datasets: [
                    {
                        label: 'Accuracy (%)',
                        data: [85, 88, 90, 92, 93, 94],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Time (s)',
                        data: [3.2, 2.8, 2.5, 2.1, 1.9, 1.8],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: 'AI Model Performance', font: { size: 16, weight: 'bold', color: '#1e293b' } }
                },
                scales: {
                    y: { position: 'left', min: 80, grid: { color: 'rgba(0,0,0,0.05)' } },
                    y1: { position: 'right', min: 0, grid: { display: false } }
                }
            }
        });

        // Load Time Chart
        const loadTimeCtx = document.getElementById('loadTimeChart').getContext('2d');
        new Chart(loadTimeCtx, {
            type: 'doughnut',
            data: {
                labels: ['App Init', 'Firebase', 'RevenueCat', 'UI Render', 'Data Load'],
                datasets: [{
                    data: [250, 180, 120, 200, 150],
                    backgroundColor: [
                        'rgba(249, 115, 22, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(168, 85, 247, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: 'Load Time Breakdown (ms)', font: { size: 16, weight: 'bold', color: '#1e293b' } },
                    legend: { position: 'right' }
                }
            }
        });

        // Navigation Active State
        window.addEventListener('scroll', () => {
            let current = '';
            const sections = document.querySelectorAll('section');
            const navLi = document.querySelectorAll('.nav-links a');

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 150) {
                    current = section.getAttribute('id');
                }
            });

            navLi.forEach(a => {
                a.classList.remove('active');
                if (a.getAttribute('href').includes(current)) {
                    a.classList.add('active');
                }
            });
        });
    </script>
</body>

</html>